@model List<Claim>

@{
    ViewData["Title"] = "HR Dashboard";
    var totalAmount = ViewBag.TotalAmount;
    var totalClaims = ViewBag.TotalClaims;
}

<div class="container-fluid mt-4">

    <!-- Summary Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white shadow">
                <div class="card-body">
                    <h5>Approved Claims</h5>
                    <h2>@totalClaims</h2>
                    <small>This Month</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white shadow">
                <div class="card-body">
                    <h5>Total Amount</h5>
                    <h2>R @totalAmount.ToString("N2")</h2>
                    <small>To Be Paid</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white shadow">
                <div class="card-body">
                    <h5>Average/Claim</h5>
                    <h2>R @((totalClaims > 0 ? totalAmount / totalClaims : 0).ToString("N2"))</h2>
                    <small>Per Lecturer</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-dark shadow">
                <div class="card-body">
                    <h5>Active Lecturers</h5>
                    <h2>@Model.Select(c => c.LecturerId).Distinct().Count()</h2>
                    <small>This Month</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="card shadow mb-4">
        <div class="card-header bg-dark text-white">
            <h4><i class="bi bi-gear"></i> Quick Actions</h4>
        </div>
        <div class="card-body">
            <button class="btn btn-primary btn-lg me-2" onclick="generateInvoices()">
                <i class="bi bi-file-earmark-invoice"></i> Generate Invoice
            </button>
            <button class="btn btn-success btn-lg me-2" onclick="downloadReport()">
                <i class="bi bi-download"></i> Download Payment Report
            </button>
            <a asp-action="ManageLecturers" class="btn btn-info btn-lg">
                <i class="bi bi-people"></i> Manage Lecturers
            </a>
        </div>
    </div>

    <!-- Claims Table -->
    <div class="card shadow">
        <div class="card-header bg-secondary text-white">
            <h4>Approved Claims - Ready for Payment</h4>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped" id="claimsTable">
                    <thead class="table-dark">
                        <tr>
                            <th><input type="checkbox" id="selectAll" /></th>
                            <th>Lecturer</th>
                            <th>Department</th>
                            <th>Hours</th>
                            <th>Rate</th>
                            <th>Total Payment</th>
                            <th>Approved Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var claim in Model)
                        {
                            <tr>
                                <td>
                                    <input type="checkbox" class="claim-checkbox" value="@claim.ClaimId" />
                                </td>
                                <td>
                                    @claim.Lecture.FirstName @claim.Lecture.LastName
                                    <br />
                                    <small class="text-muted">@claim.Lecture.Email</small>
                                </td>
                                <td>@claim.Lecture.Department</td>
                                <td>@claim.HoursWorked</td>
                                <td>R @claim.HourlyRate.ToString("N2")</td>
                                <td><strong>R @claim.TotalPayment.ToString("N2")</strong></td>
                                <td>@claim.ApprovalDate?.ToString("dd MMM yyyy")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Select all checkboxes
    $('#selectAll').click(function() {
        $('.claim-checkbox').prop('checked', this.checked);
    });

    // Generate invoices for selected claims
    function generateInvoices() {
        var selectedClaims = [];
        $('.claim-checkbox:checked').each(function() {
            selectedClaims.push($(this).val());
        });

        if (selectedClaims.length === 0) {
            alert('Please select at least one claim');
            return;
        }

        if (confirm('Generate invoice for ' + selectedClaims.length + ' claim(s)?')) {
            $.post('@Url.Action("GenerateInvoice", "HR")',
                { claimIds: selectedClaims })
                .done(function() {
                    alert('Invoice generated successfully!');
                    location.reload();
                })
                .fail(function() {
                    alert('Error generating invoice');
                });
        }
    }

    // Download payment report
    function downloadReport() {
        var month = new Date().getMonth() + 1;
        var year = new Date().getFullYear();

        window.location.href = '@Url.Action("DownloadReport", "HR")' +
            '?year=' + year + '&month=' + month;
    }
</script>
